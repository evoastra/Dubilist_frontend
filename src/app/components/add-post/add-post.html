<div class="m-3 pt-0 mt-5">
  <div class="add-post-wrapper">
    <h3 class="text-center fw-bold form-title" style="color: #ffa500;">Post Your Ad</h3>

    <form #f="ngForm" (ngSubmit)="submit(f)" class="add-post-card mx-5" novalidate>
      <div class="row">
        <div class="col-md-6">

          <!-- MAIN CATEGORY -->
          <div class="form-group mb-3">
            <label class="form-label">Category</label>
            <select class="form-select"
                    [ngModel]="selectedMainCategoryId"
                    (ngModelChange)="onMainCategoryChange($event)"
                    name="mainCategory"
                    required>
              <option [ngValue]="null" disabled>Select Category</option>
              <option *ngFor="let c of mainCategories" [ngValue]="c.id">
                {{ c.name }}
              </option>
            </select>
          </div>

          <!-- SUB CATEGORY -->
          <div class="form-group mb-3" *ngIf="selectedMainCategoryId && filteredSubCategories.length">
            <label class="form-label">Sub Category</label>
            <select class="form-select"
                    [(ngModel)]="selectedSubCategoryId"
                      (ngModelChange)="onSubCategoryChange($event)"
                    name="subCategory">
              <option [ngValue]="null" disabled>Select sub category</option>
              <option *ngFor="let sc of filteredSubCategories" [ngValue]="sc.id">
                {{ sc.name }}
              </option>
            </select>
          </div>

          <!-- TITLE -->
          <div class="form-group mb-3">
            <label class="form-label">Ad Title</label>
            <input class="form-control"
                   placeholder="Title"
                   (focus)="onFieldAttemptFocus($event)"
                   [(ngModel)]="model.title"
                   name="title"
                   required />
          </div>

          <!-- ------------------------ MOTORS ------------------------- -->
          <ng-container *ngIf="selectedMainCategoryId === 1">
            <label class="form-label small text-muted mb-2 fw-bold text-uppercase">Vehicle Details</label>

            <div class="row">
              <div class="col-6 mb-2">
                <label class="form-label">Make</label>
                <input class="form-control" [(ngModel)]="model.make" name="make" placeholder="Tesla" />
              </div>
              <div class="col-6 mb-2">
                <label class="form-label">Model</label>
                <input class="form-control" [(ngModel)]="model.model" name="model" placeholder="GLX">

              </div>
            </div>

            <div class="row">
              <div class="col-6 mb-2">
                <label class="form-label">Variant / Trim</label>
                <input class="form-control" [(ngModel)]="model.variant" name="variant" placeholder="GLX, Sport" />
              </div>
              <div class="col-6 mb-2">
                <label class="form-label">Color</label>
                <input class="form-control" [(ngModel)]="model.color" name="color" placeholder="White" />
              </div>
            </div>

            <div class="row">
              <div class="col-6 mb-2">
                <label class="form-label">Year</label>
                <input type="number" class="form-control" [(ngModel)]="model.year" name="year" placeholder="2022" />
              </div>
              <div class="col-6 mb-2">
                <label class="form-label">Kilometres</label>
                <input type="number" class="form-control" [(ngModel)]="model.kilometres" name="kilometres" placeholder="35000" />
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label">Body Type</label>
              <select class="form-select" [(ngModel)]="model.bodyType" name="bodyType">
                <option value="Sedan">Sedan</option>
                <option value="SUV">SUV</option>
                <option value="Coupe">Coupe</option>
                <option value="Truck">Truck</option>
                <option value="Van">Van</option>
              </select>
            </div>

            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" [(ngModel)]="model.serviceHistory" name="serviceHistory">
              <label class="form-check-label">Full Service History Available</label>
            </div>
          
            <div class="mb-2">
  <label class="form-label">Condition</label>
  <select class="form-select"
          [(ngModel)]="model.condition"
          name="condition"
          required>
    <option [ngValue]="null" disabled>Select condition</option>
    <option value="New">New</option>
    <option value="Used">Used</option>
  </select>
</div>

             
            <!-- FUEL TYPE -->
            <div class="mb-3 price-box">
              <label class="form-label d-block">Fuel Type</label>
              <div class="btn-group w-100">
                <button type="button" class="btn btn-outline-light"
                        [class.active]="model.fuelType === 'Petrol'"
                        (click)="model.fuelType = 'Petrol'">Petrol</button>

                <button type="button" class="btn btn-outline-light"
                        [class.active]="model.fuelType === 'Diesel'"
                        (click)="model.fuelType = 'Diesel'">Diesel</button>

                <button type="button" class="btn btn-outline-light"
                        [class.active]="model.fuelType === 'Electric'"
                        (click)="model.fuelType = 'Electric'">Electric</button>

                <button type="button" class="btn btn-outline-light"
                        [class.active]="model.fuelType === 'Hybrid'"
                        (click)="model.fuelType = 'Hybrid'">Hybrid</button>
              </div>
            </div>
          </ng-container>


          <!-- ------------------------ JOBS ------------------------- -->
          <ng-container *ngIf="selectedMainCategoryId === 2">
            <label class="form-label small text-muted mb-2 fw-bold text-uppercase">Job Details</label>

            <div class="mb-2">
              <label class="form-label">Job Title</label>
              <input class="form-control" [(ngModel)]="model.jobTitle" name="jobTitle" placeholder="Sales Manager">
            </div>

            <div class="row">
              <div class="col-6 mb-2">
                <label class="form-label">Company Name</label>
                <input class="form-control" [(ngModel)]="model.companyName" name="companyName">
              </div>
              <div class="col-6 mb-2">
                <label class="form-label">Industry</label>
                <input class="form-control" [(ngModel)]="model.industry" name="industry">
              </div>
            </div>

            <div class="row">
              <div class="col-6 mb-2">
                <label class="form-label">Job Type</label>
                <select class="form-select" [(ngModel)]="model.jobType" name="jobType">
                  <option value="Full-time">Full-time</option>
                  <option value="Part-time">Part-time</option>
                  <option value="Contract">Contract</option>
                  <option value="Internship">Internship</option>
                </select>
              </div>
              <div class="col-6 mb-2">
                <label class="form-label">Workplace</label>
                <select class="form-select" [(ngModel)]="model.workplaceType" name="workplaceType">
                  <option value="On-site">On-site</option>
                  <option value="Remote">Remote</option>
                  <option value="Hybrid">Hybrid</option>
                </select>
              </div>
            </div>

            <label class="form-label">Experience (Years)</label>
            <div class="row">
              <div class="col-6">
                <input class="form-control" type="number"
                       [(ngModel)]="model.experienceMin" name="experienceMin"
                       placeholder="Min (e.g. 2)">
              </div>
              <div class="col-6">
                <input class="form-control" type="number"
                       [(ngModel)]="model.experienceMax" name="experienceMax"
                       placeholder="Max (e.g. 5)">
              </div>
            </div>

            <label class="form-label">Salary Range</label>
            <div class="row">
              <div class="col-4">
                <input class="form-control" type="number"
                       [(ngModel)]="model.salaryMin" name="salaryMin"
                       placeholder="Min">
              </div>
              <div class="col-4">
                <input class="form-control" type="number"
                       [(ngModel)]="model.salaryMax" name="salaryMax"
                       placeholder="Max">
              </div>
              <div class="col-4">
                <select class="form-select" [(ngModel)]="model.salaryPeriod" name="salaryPeriod">
                  <option value="Monthly">Monthly</option>
                  <option value="Yearly">Yearly</option>
                </select>
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label">Application Email</label>
              <input type="email" class="form-control"
                     [(ngModel)]="model.applicationEmail" name="applicationEmail">
            </div>

            <div class="mb-2">
              <label class="form-label">Responsibilities</label>
              <textarea class="form-control" rows="3"
                        [(ngModel)]="model.responsibilities" name="responsibilities"></textarea>
            </div>

            <div class="mb-2">
              <label class="form-label">Skills / Requirements</label>
              <textarea class="form-control" rows="3"
                        [(ngModel)]="model.skillsRequired" name="skillsRequired"></textarea>
            </div>

          </ng-container>


          <!-- ------------------------ PROPERTY ------------------------- -->
          <ng-container *ngIf="selectedMainCategoryId === 3">

            <label class="form-label small text-muted mb-2 fw-bold text-uppercase">Property Details</label>

            <!-- Listing Type -->
            <div class="price-box mb-3">
              <label class="form-label d-block">Listing Type</label>
              <div class="btn-group bg-white w-100">
                <button type="button" class="btn btn-light"
                        [class.active]="model.listingType === 'For Sale'"
                        (click)="model.listingType = 'For Sale'">For Sale</button>

                <button type="button" class="btn btn-light"
                        [class.active]="model.listingType === 'For Rent'"
                        (click)="model.listingType = 'For Rent'">For Rent</button>
              </div>
            </div>

            <div class="row">
              <div class="col-6 mb-2">
                <label class="form-label">Property Type</label>
                <select class="form-select" [(ngModel)]="model.propertyType" name="propertyType">
                  <option value="Apartment">Apartment</option>
                  <option value="Villa">Villa</option>
                  <option value="Office">Office</option>
                  <option value="Townhouse">Townhouse</option>
                </select>
              </div>
              <div class="col-6 mb-2">
                <label class="form-label">Area (Sqft)</label>
                <input class="form-control" type="number"
                       [(ngModel)]="model.areaSqft" name="areaSqft"
                       placeholder="1200">
              </div>
            </div>

            <div class="row">
              <div class="col-4 mb-2">
                <label>Bedrooms</label>
                <input class="form-control" type="number" [(ngModel)]="model.bedrooms" name="bedrooms">
              </div>
              <div class="col-4 mb-2">
                <label>Bathrooms</label>
                <input class="form-control" type="number" [(ngModel)]="model.bathrooms" name="bathrooms">
              </div>
              <div class="col-4 mb-2">
                <label>Halls</label>
                <input class="form-control" type="number" [(ngModel)]="model.halls" name="halls">
              </div>
            </div>

            <div class="mb-3" *ngIf="model.listingType === 'For Rent'">
              <label class="form-label">Rent Frequency</label>
              <select class="form-select" [(ngModel)]="model.rentFrequency" name="rentFrequency">
                <option value="Monthly">Monthly</option>
                <option value="Yearly">Yearly</option>
                <option value="Weekly">Weekly</option>
              </select>
            </div>

            <div class="price-box mb-3">
               <label class="form-label d-block">Furnishing</label>
               <div class="btn-group bg-white w-100">
                 <button type="button" class="btn btn-light"
                         [class.active]="model.furnishing === 'Furnished'"
                         (click)="model.furnishing = 'Furnished'">Furnished</button>

                 <button type="button" class="btn btn-light"
                         [class.active]="model.furnishing === 'Unfurnished'"
                         (click)="model.furnishing = 'Unfurnished'">Unfurnished</button>

                 <button type="button" class="btn btn-light"
                         [class.active]="model.furnishing === 'Partly'"
                         (click)="model.furnishing = 'Partly'">Partly</button>
               </div>
            </div>

            <div class="p-2 form-group bg-white rounded">
              <label class="form-label d-block">Amenities</label>
              <div class="amenities-wrapper">
                <button type="button"
                        *ngFor="let a of amenitiesOptions"
                        class="btn btn-outline-warning amenity-btn btn-sm m-1"
                        [class.active]="model.amenities.includes(a)"
                        (click)="toggleAmenity(a)">
                  {{ a }}
                </button>
              </div>
            </div>

          </ng-container>


          <!-- ------------------------ ELECTRONICS ------------------------- -->
          <ng-container *ngIf="selectedMainCategoryId === 5">

            <label class="form-label small text-muted mb-2 fw-bold text-uppercase">Device Details</label>

            <div class="row">
              <div class="col-6 mb-2">
                <label class="form-label">Brand</label>
                <input class="form-control" [(ngModel)]="model.brand" name="electronicBrand">
              </div>
              <div class="col-6 mb-2">
                <label class="form-label">Model</label>
                <input class="form-control" [(ngModel)]="model.model" name="electronicModel">
              </div>
            </div>

            <div class="row">
              <div class="col-6 mb-2">
                <label class="form-label">Storage</label>
                <input class="form-control" [(ngModel)]="model.storage" name="storage" placeholder="256GB">
              </div>
              <div class="col-6 mb-2">
                <label class="form-label">Color</label>
                <input class="form-control" [(ngModel)]="model.color" name="color">
              </div>
            </div>

            <div class="row">
              <div class="col-6 mb-2">
                <label>Warranty Status</label>
                <select class="form-select" [(ngModel)]="model.warrantyStatus" name="warrantyStatus">
                  <option value="Active">Active</option>
                  <option value="Expired">Expired</option>
                  <option value="None">None</option>
                </select>
              </div>
              <div class="col-6 mb-2">
                <label>Condition</label>
                <select class="form-select" [(ngModel)]="model.condition" name="condition">
                  <option value="New">New</option>
                  <option value="Like New">Like New</option>
                  <option value="Used">Used</option>
                </select>
              </div>
            </div>

            <div class="d-flex gap-3 mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox"
                       [(ngModel)]="model.hasOriginalBox" name="hasOriginalBox">
                <label class="form-check-label">Has Original Box</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox"
                       [(ngModel)]="model.hasCharger" name="hasCharger">
                <label class="form-check-label">Has Charger</label>
              </div>
            </div>

          </ng-container>


          <!-- ------------------------ CLASSIFIEDS / FURNITURE ------------------------- -->
          <ng-container *ngIf="selectedMainCategoryId === 4 || selectedMainCategoryId === 6">

            <label class="form-label small text-muted mb-2 fw-bold text-uppercase">Item Details</label>

            <div class="mb-2">
              <label>Brand</label>
              <input class="form-control" [(ngModel)]="model.brand" name="brand">
            </div>

            <div class="row">
              <div class="col-6 mb-2">
                <label>Material</label>
                <input class="form-control" [(ngModel)]="model.material" name="material">
              </div>
              <div class="col-6 mb-2">
                <label>Condition</label>
                <select class="form-select" [(ngModel)]="model.condition" name="condition">
                  <option value="New">New</option>
                  <option value="Good">Good</option>
                  <option value="Fair">Fair</option>
                </select>
              </div>
            </div>

            <div class="mb-3">
              <label>Dimensions</label>
              <input class="form-control"
                     [(ngModel)]="model.dimensions" name="dimensions"
                     placeholder="200x150x90 cm">
            </div>

          </ng-container>

        </div>


        <!-- -------------------- RIGHT SIDE --------------------- -->

        <div class="col-md-6">

          <!-- Transmission (Motors) -->
          <ng-container *ngIf="selectedMainCategoryId === 1">
            <div class="mb-3 price-box p-3">
              <label class="form-label d-block">Transmission</label>
              <div class="btn-group w-100">
                <button type="button" class="btn btn-outline-light"
                        [class.active]="model.transmission === 'Automatic'"
                        (click)="model.transmission = 'Automatic'">Automatic</button>

                <button type="button" class="btn btn-outline-light"
                        [class.active]="model.transmission === 'Manual'"
                        (click)="model.transmission = 'Manual'">Manual</button>
              </div>
            </div>
          </ng-container>

          <!-- PRICE -->
          <div class="price-box mb-3 form-group" *ngIf="selectedMainCategoryId !== 2">
            <label class="form-label d-block">Price</label>
            <div class="input-group mb-2">
              <span class="input-group-text">AED</span>
              <input class="form-control"
                     type="number"
                     [(ngModel)]="model.price"
                     name="price"
                     required />
            </div>
            <div class="form-check small">
              <input type="checkbox" class="form-check-input"
                     [(ngModel)]="model.isNegotiable" name="isNegotiable">
              <label class="form-check-label">Price is negotiable</label>
            </div>
          </div>

          <!-- LOCATION -->
          <div class="price-box mb-3 form-group">
            <label class="form-label">Location</label>
            <input class="form-control mb-2"
                   placeholder="City"
                   [(ngModel)]="model.city"
                   name="city">

            <input class="form-control"
                   placeholder="Neighbourhood / Address"
                   [(ngModel)]="model.address"
                   name="address">
          </div>

          <!-- CONTACT -->
          <div class="price-box mb-3 form-group">
            <label class="form-label">Contact Information</label>
            <input class="form-control mb-2" placeholder="Name"
                   [(ngModel)]="model.contactName" name="contactName">

            <div class="input-group mb-1">
              <span class="input-group-text">+971</span>
              <input class="form-control"
                     placeholder="Mobile Number"
                     [(ngModel)]="model.contactPhone"
                     name="contactPhone">
            </div>

            <div class="form-check small mt-1">
              <input class="form-check-input" type="checkbox"
                     [(ngModel)]="model.contactWhatsapp"
                     name="contactWhatsapp"
                     [value]="model.contactPhone"
                    >
              <label>Available on WhatsApp</label>
            </div>
          </div>

        </div>
      </div>

      <!-- FILE UPLOAD -->
      <div class="mb-3">
        <label class="form-label">{{ fileUploadLabel }}</label>

        <!-- JOBS LOGO UPLOAD -->
        <ng-container *ngIf="selectedMainCategoryId === 2">
          <div class="file-drop-zone"
               (dragover)="onDragOver($event)"
               (dragleave)="onDragLeave($event)"
               (drop)="onDropLogo($event)"
               [class.disabled]="logoFile">
            <i class="bi bi-cloud-upload"></i>
            <p>Upload Company Logo</p>
            <input type="file" class="form-control"
                   [accept]="acceptedFileTypes"
                   (change)="onFileChange($event)"
                   [disabled]="logoFile">
          </div>

          <div class="logo-preview mt-3" *ngIf="logoPreview">
             <div class="d-flex align-items-center border p-2 rounded">
                <img [src]="logoPreview" style="height:50px;" />
                <span class="ms-2 small">{{ logoFile?.name }}</span>
                <button type="button" class="btn btn-sm text-danger ms-auto"
                        (click)="removeLogo()">&times;</button>
             </div>
          </div>
        </ng-container>

        <!-- NORMAL IMAGES -->
        <ng-container *ngIf="selectedMainCategoryId !== 2">
          <div class="file-drop-zone"
               (dragover)="onDragOver($event)"
               (dragleave)="onDragLeave($event)"
               (drop)="onDropFiles($event)"
               [class.disabled]="files.length >= maxImages">
            <i class="bi bi-cloud-upload"></i>
            <p>Upload Images (Max {{ maxImages }})</p>
            <input type="file"
                   class="form-control"
                   [accept]="acceptedFileTypes"
                   multiple
                   (change)="onFileChange($event)"
                   [disabled]="files.length >= maxImages" />
          </div>

          <div class="image-preview-container mt-3" *ngIf="imagePreviews.length">
            <div class="preview-grid">
              <div class="preview-item position-relative"
                   *ngFor="let preview of imagePreviews; let i = index">
                <img [src]="preview" />
                <button type="button" class="btn-remove" (click)="removeImage(i)">&times;</button>
                <div class="order-badge" *ngIf="i === 0">Cover</div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- AI BOX -->
      <div class="ai-box mb-3 d-flex flex-row justify-content-center align-items-center">
        <div class="ai-icon me-2">ðŸ§ </div>
        <div class="flex-grow-1">
          <p class="fw-bold mb-1 small">Save time with AI.</p>
          <p class="small mb-0">Generate description from given data.</p>
        </div>
        <button type="button"
                class="btn btn-warning rounded-pill px-4 py-2 text-white"
                (click)="generateDescription()">
          Generate
        </button>
      </div>

      <!-- DESCRIPTION -->
      <div class="form-group mb-4">
        <label class="form-label">Description</label>
        <textarea class="form-control"
                  rows="6"
                  [(ngModel)]="model.description"
                  name="description"></textarea>
      </div>

      <div class="text-center pb-3 mt-4">
        <button class="btn btn-warning px-5 fw-bold text-white"
                type="submit"
                [disabled]="f.invalid">
          Next Step
        </button>
      </div>
    </form>
  </div>
</div>

<!-- MODAL -->
<div class="modal-backdrop-custom" *ngIf="showSelectCategoryModal">
  <div class="modal-dialog-custom">
    <h5 class="mb-3">Select a category</h5>
    <p class="mb-3">Please choose a category to see relevant fields.</p>
    <button class="btn btn-warning" (click)="closeCategoryModal()">OK</button>
  </div>
</div>
