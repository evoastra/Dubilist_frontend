<nav class="navbar navbar-expand-lg navbar-light bg-white py-3 px-lg-5 shadow-sm sticky-top"
     *ngIf="!hideNavbar">

  <div class="container-fluid px-5">

    <a class="navbar-brand d-flex align-items-center fw-bold fs-3"
       routerLink="/home">
      <img src="assets/images/logo.png"
           alt="Dubilist Logo"
           class="me-2"
           style="height: 30px;" />

      <span *ngIf="isAdmin"
            class="badge bg-warning text-dark ms-2">
        Admin Panel
      </span>
    </a>

    <button class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">

      <ul class="navbar-nav ms-auto align-items-center gap-3">

        <ng-container *ngIf="!isAdmin">

          <li class="nav-item text-center px-2" *ngIf="user"
              (click)="navigateToFavourites()">
            <i class="bi bi-heart d-block"></i>
            <small>Favourites</small>
          </li>

          <li class="nav-item text-center px-2" *ngIf="user"
              (click)="navigateToChats()">
            <i class="bi bi-chat-dots d-block"></i>
            <small>Chats</small>
          </li>

          <li class="nav-item text-center px-2" *ngIf="user"
              (click)="navigateToMyAds()">
            <i class="bi bi-card-list d-block"></i>
            <small>My Ads</small>
          </li>

          <li class="nav-item ms-lg-3" *ngIf="!user">
            <button class="btn btn-outline-secondary px-4"
                    (click)="onLoginClick()">
              Log In / Sign Up
            </button>
          </li>

          <li class="nav-item ms-lg-3 cursor-pointer" *ngIf="user" (click)="toggleOverlay()">
            <div class="d-flex align-items-center gap-2">
               <img [src]="user.avatarUrl || 'assets/default-avatar.png'" 
                   alt="User" 
                   class="rounded-circle border"
                   style="width: 40px; height: 40px; object-fit: cover;">
              <span class="fw-bold text-dark">{{ user.name }}</span>
            </div>
          </li>

          <li class="nav-item">
            <button class="btn btn-warning text-white fw-bold px-4"
                    (click)="onPlaceAdClick()">
              Place Ad
            </button>
          </li>

        </ng-container>

        <ng-container *ngIf="isAdmin">

          <li class="nav-item fw-semibold text-secondary">
            {{ user?.name }} (Admin)
          </li>

          <li class="nav-item">
            <button class="btn btn-outline-secondary btn-sm"
                    (click)="goToWebsite()">
              Go to Website
            </button>
          </li>

          <li class="nav-item">
            <button class="btn btn-danger btn-sm"
                    (click)="onLogout()">
              Logout
            </button>
          </li>

        </ng-container>

      </ul>
    </div>
  </div>
</nav>

<div class="modal-overlay" *ngIf="showLoginModal">
  <div class="modal-box">
    <h4 class="modal-title">
      <i class="bi bi-exclamation-circle-fill me-2 text-warning"></i>
      Login Required
    </h4>
    <p>Please log in to place an ad.</p>
    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
      <button class="btn btn-warning text-white" (click)="goToLogin()">Login</button>
    </div>
  </div>
</div>

<div class="profile-overlay-backdrop" *ngIf="isOverlayOpen" (click)="toggleOverlay()"></div>

<div class="profile-card-container shadow-lg" *ngIf="isOverlayOpen">
  
  <div class="card-sidebar">
    <div class="sidebar-top">
      <div class="sidebar-item" 
           [class.active]="activeTab === 'profile'"
           (click)="switchTab('profile')">
        <i class="bi bi-person-circle fs-5"></i>
        <span>My Profile</span>
      </div>

      <div class="sidebar-item"
           [class.active]="activeTab === 'settings'"
           (click)="switchTab('settings')">
        <i class="bi bi-gear fs-5"></i>
        <span>Account Settings</span>
      </div>
    </div>

    <div class="sidebar-footer">
      <button class="btn-logout-card" (click)="onLogout()">
        <i class="bi bi-box-arrow-right me-2"></i> LogOut
      </button>
    </div>
  </div>

  <div class="card-content">
    
   <div *ngIf="activeTab === 'profile'" class="animate-fade-in">
    
    <div *ngIf="!isEditingProfile">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold m-0">My Profile</h4>
      </div>

      <div class="profile-header-card text-center mb-4">
        <div class="avatar-container mx-auto position-relative">
          <img [src]="user?.avatarUrl || 'assets/default-avatar.png'" 
               class="rounded-circle img-thumbnail shadow-sm mb-3" 
               style="width: 120px; height: 120px; object-fit: cover;">
        </div>
        <h4 class="fw-bold mb-1">{{ user?.name }}</h4>
        <p class="text-warning small mb-3">Joined in {{ user?.createdAt | date:'yyyy' }}</p>
        
        <button class="btn btn-warning text-white fw-bold w-100 py-2 shadow-sm mb-4" 
                (click)="enterEditMode()">
          Edit Profile
        </button>
      </div>

      <h5 class="fw-bold mb-3">Contact Information</h5>
      <hr class="text-muted opacity-25">
      
      <div class="mb-3">
        <label class="text-warning small fw-bold d-block">Email</label>
        <span class="fw-normal">{{ user?.email }}</span>
      </div>
      
      <div class="mb-3">
        <label class="text-warning small fw-bold d-block">Mobile Number (WhatsApp enabled)</label>
        <span class="fw-normal">{{ user?.phone || 'Not provided' }}</span>
      </div>
    </div>

    <div *ngIf="isEditingProfile" class="animate-fade-in">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold m-0">Edit Profile</h4>
        <button class="btn btn-link text-dark text-decoration-none p-0" (click)="exitEditMode()">
          <i class="bi bi-arrow-left me-1"></i> Back
        </button>
      </div>

      <div class="text-center mb-4">
        <div class="avatar-edit-wrapper mx-auto mb-2 position-relative cursor-pointer" 
             (click)="!isUploading && triggerFileInput()">
          <img [src]="user?.avatarUrl || 'assets/default-avatar.png'" 
               class="rounded-circle img-thumbnail" 
               [style.opacity]="isUploading ? '0.5' : '1'"
               style="width: 110px; height: 110px; object-fit: cover;">
          
          <div *ngIf="isUploading" class="position-absolute top-50 start-50 translate-middle">
            <div class="spinner-border text-warning" role="status"></div>
          </div>
          
          <div *ngIf="!isUploading" class="camera-overlay">
            <i class="bi bi-camera-fill text-white fs-4"></i>
          </div>
        </div>
        
        <input type="file" id="avatarUpload" (change)="onFileSelected($event)" accept="image/*" hidden>
        <button class="btn btn-link text-warning text-decoration-none small fw-bold" (click)="triggerFileInput()">
          {{ isUploading ? 'Uploading...' : 'Change Profile Photo' }}
        </button>
      </div>

      <div class="edit-form-fields">
        <div class="mb-3">
          <label class="fw-bold small mb-1">Name</label>
          <div class="input-group-custom">
            <input type="text" class="form-control" [(ngModel)]="editForm.name">
            <i class="bi bi-pencil-square"></i>
          </div>
        </div>

        <div class="mb-3">
          <label class="fw-bold small mb-1">Mobile Number</label>
          <div class="input-group-custom">
            <input type="text" class="form-control text-warning fw-bold" [(ngModel)]="editForm.phone">
            <i class="bi bi-pencil-square"></i>
          </div>
        </div>

        <div class="mb-4">
          <label class="fw-bold small mb-1">Email Id</label>
          <div class="input-group-custom bg-light rounded">
            <input type="email" class="form-control bg-transparent text-muted" [value]="user?.email" disabled>
            <i class="bi bi-pencil-square"></i>
          </div>
        </div>

        <button class="btn btn-warning text-white w-100 fw-bold py-2 shadow-sm" (click)="saveProfileChanges()">
          Save Changes
        </button>
      </div>
    </div>
  </div>

    <div *ngIf="activeTab === 'settings'" class="animate-fade-in">
      <h4 class="fw-bold mb-4">Account Settings</h4>
      
      <div class="settings-list">
      <div class="settings-item d-flex justify-content-between align-items-center">
  <div class="d-flex align-items-center gap-3">
    <i class="bi bi-bell text-warning"></i>
    <span>Notifications</span>
  </div>
  
  <div class="form-check form-switch p-0 m-0">
    <input class="form-check-input custom-toggle" 
           type="checkbox" 
           role="switch" 
           id="notificationToggle">
  </div>
</div>

        <div class="settings-item">
          <div class="d-flex align-items-center gap-3">
            <i class="bi bi-shield-lock text-warning"></i>
            <span>Privacy Settings</span>
          </div>
          <i class="bi bi-chevron-down"></i>
        </div>

        <div class="settings-item">
          <div class="d-flex align-items-center gap-3">
            <i class="bi bi-info-circle text-warning"></i>
            <span>About Us</span>
          </div>
        </div>

        <div class="settings-item">
          <div class="d-flex align-items-center gap-3">
            <i class="bi bi-file-earmark-text text-warning"></i>
            <span>Privacy Policy</span>
          </div>
        </div>

        <div class="settings-item">
          <div class="d-flex align-items-center gap-3">
            <i class="bi bi-exclamation-triangle text-warning"></i>
            <span>Terms and Conditions</span>
          </div>
        </div>

        <div class="settings-item">
          <div class="d-flex align-items-center gap-3">
            <i class="bi bi-question-circle text-warning"></i>
            <span>Help & Support</span>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="custom-toast shadow-lg" [class.show]="showToast">
  <div class="d-flex align-items-center gap-2 px-2">
    <i class="bi bi-check-circle-fill text-success" *ngIf="!toastMessage.includes('Error') && !toastMessage.includes('failed')"></i>
    <i class="bi bi-exclamation-triangle-fill text-danger" *ngIf="toastMessage.includes('Error') || toastMessage.includes('failed')"></i>
    <span class="fw-semibold">{{ toastMessage }}</span>
  </div>
</div>